<!DOCTYPE html>
<!--
  Emoji Editor
  Copyright 2016 YUKI "Piro" Hiroshi
  The MIT License: http://opensource.org/licenses/MIT

  Original:
    "preview.html" from https://github.com/twitter/twemoji
    Copyright 2014 Twitter, Inc and other contributors
    Code licensed under the MIT License: http://opensource.org/licenses/MIT
-->
<html>
  <head>
    <meta charset="UTF-8">
    <title>Emoji Editor</title>
    <style>
    #emoji-palette ul {
      margin: 0 0 1em 0;
      padding: 0;
    }
    li.emoji,
    li.emoji * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    li.emoji {
      cursor: pointer;
      font-size: 36px;
      width: 36px;
      height: 36px;
      display: inline-block;
      padding: 6px 8px;
      margin: 0;
    }
    img.emoji {
      height: 1em;
      width: 1em;
      margin: 0 .05em 0 .1em;
      vertical-align: -0.1em;
    }
    li.emoji img.emoji {
      margin: 0;
    }
    h1, h2 {
      display: none;
    }
    #editor {
      border: 1px inset;
      padding: 0.5em;
      overflow: auto;
      height: 20em;
      resize: vertical;
      white-space: pre-wrap;
    }
    #editor[data-blank="true"]:not(:focus):not(:active)::before {
      content: attr(data-placeholder);
      opacity: 0.5;
    }
    #recent {
      padding: 0.5em;
      position: fixed;
      left: 0;
      right: 0;
      border-bottom: 1px solid gray;
      max-height: 100px;
    }
    #recent h3 {
      display: none;
    }
    #all h3:first-child {
      margin-top: 0.2em;
    }
    #all {
      padding: 0.5em;
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: auto;
    }
    </style>
    <!--script src="./twemoji.min.js"></script-->
  </head>
  <body onload="init();"
        onunload="destroy();"
        onresize="updateLayout();">
    <h1>Simple Text Editor with Twitter Emoji (Twemoji)</h1>
    <div id="editor"
         contenteditable="true"
         data-placeholder="Input text including Emoji here."
         data-blank="true"></div>
    <section id="emoji-palette"
             onclick="insertEmoji(event);">
      <h2>Available Emoji</h2>
      <section id="recent">
        <h3>Recent</h3>
        <ul>
        </ul>
      </section>
      <section id="all">
        <h3>People, emotion</h3>
        <ul>
          <!-- Face, emoticon -->
          <li>ğŸ˜</li>
          <li>ğŸ˜‚</li>
          <li>ğŸ™‚</li>
          <li>ğŸ˜ƒ</li>
          <li>ğŸ˜„</li>
          <li>ğŸ˜…</li>
          <li>ğŸ˜†</li>
          <li>ğŸ¤£</li>
          <li>ğŸ™ƒ</li>
          <li>ğŸ¤—</li>
          <li>ğŸ˜‰</li>
          <li>ğŸ˜Š</li>
          <li>ğŸ˜‹</li>
          <li>ğŸ¤¤</li>
          <li>ğŸ˜</li>
          <li>ğŸ˜˜</li>
          <li>ğŸ˜š</li>
          <li>â˜º</li>
          <li>ğŸ˜</li>
          <li>ğŸ˜£</li>
          <li>ğŸ˜¥</li>
          <li>ğŸ˜ª</li>
          <li>ğŸ˜«</li>
          <li>ğŸ˜Œ</li>
          <li>ğŸ˜œ</li>
          <li>ğŸ˜</li>
          <li>ğŸ˜’</li>
          <li>ğŸ˜“</li>
          <li>ğŸ˜”</li>
          <li>ğŸ˜–</li>


          <!-- Sick -->
          <li>ğŸ˜·</li>
          <li>ğŸ¤•</li>
          <li>ğŸ¤¢</li>
          <li>ğŸ¤§</li>

          <li>ğŸ˜²</li>
          <li>ğŸ˜</li>
          <li>ğŸ˜¤</li>
          <li>ğŸ˜¢</li>
          <li>ğŸ˜­</li>
          <li>ğŸ˜¨</li>
          <li>ğŸ˜©</li>
          <li>ğŸ˜°</li>
          <li>ğŸ˜±</li>
          <li>ğŸ˜³</li>
          <li>ğŸ™„</li>
          <li>ğŸ˜µ</li>
          <li>ğŸ˜¡</li>
          <li>ğŸ˜ </li>
          <li>ğŸ‘¿</li>
          <li>ğŸ˜€</li>
          <li>ğŸ˜‡</li>
          <li>ğŸ˜ˆ</li>
          <li>ğŸ˜</li>
          <li>ğŸ˜</li>
          <li>ğŸ˜‘</li>
          <li>ğŸ˜•</li>
          <li>ğŸ˜—</li>
          <li>ğŸ˜™</li>
          <li>ğŸ˜›</li>
          <li>ğŸ˜Ÿ</li>
          <li>ğŸ˜¦</li>
          <li>ğŸ™</li>
          <li>â˜¹</li>
          <li>ğŸ˜§</li>
          <li>ğŸ˜¬</li>
          <li>ğŸ˜®</li>
          <li>ğŸ˜¯</li>
          <li>ğŸ¤”</li>
          <li>ğŸ˜´</li>
          <li>ğŸ˜¶</li>
          <li>ğŸ¤</li>
          <li>ğŸ¤‘</li>
          <li>ğŸ¤’</li>
          <li>ğŸ¤“</li>
          <li>ğŸ¤¥</li>
 
          <!-- Non-human -->
          <li>ğŸ‘¹</li>
          <li>ğŸ‘º</li>
          <li>ğŸ’€</li>
          <li>ğŸ‘»</li>
          <li>ğŸ‘½</li>
          <li>ğŸ‘¾</li>
          <li>ğŸ’©</li>
          <li>ğŸ¤–</li>
          <li>ğŸ¤ </li>
          <li>ğŸ¤¡</li>
          <li>ğŸ˜º</li>
          <li>ğŸ˜¸</li>
          <li>ğŸ˜¹</li>
          <li>ğŸ˜»</li>
          <li>ğŸ˜¼</li>
          <li>ğŸ˜½</li>
          <li>ğŸ™€</li>
          <li>ğŸ˜¿</li>
          <li>ğŸ˜¾</li>
          <li>ğŸ™ˆ</li>
          <li>ğŸ™‰</li>
          <li>ğŸ™Š</li>

          <!-- Human -->
          <li>ğŸ‘¦</li>
          <li>ğŸ‘§</li>
          <li>ğŸ‘¨</li>
          <li>ğŸ‘©</li>
          <li>ğŸ‘´</li>
          <li>ğŸ‘µ</li>
          <li>ğŸ‘¶</li>
          <li>ğŸ‘®</li>
          <li>ğŸ‘·</li>
          <li>â›‘</li>
          <li>ğŸ‘¸</li>
          <li>ğŸ’‚</li>
          <li>ğŸ‘±</li>
          <li>ğŸ‘²</li>
          <li>ğŸ‘³</li>
          <li>ğŸ…</li>
          <li>ğŸ‘¼</li>
          <li>ğŸ¤´</li>
          <li>ğŸ¤µ</li>
          <li>ğŸ¤¶</li>
          <li>ğŸ•´</li>
 
          <li>ğŸ‘¬</li>
          <li>ğŸ‘­</li>
          <li>ğŸ‘¯</li>
          <li>ğŸ’†</li>
          <li>ğŸ’‡</li>
          <li>ğŸ‘°</li>
          <li>ğŸ™</li>
          <li>ğŸ™</li>
          <li>ğŸ™…</li>
          <li>ğŸ™†</li>
          <li>ğŸ’</li>
          <li>ğŸ™‹</li>
          <li>ğŸ¤¦</li>
          <li>ğŸ¤·</li>
          <li>ğŸ™‡</li>
          <li>ğŸ™Œ</li>
          <li>ğŸ™</li>
          <li>ğŸ‘¤</li>
          <li>ğŸ‘¥</li>
 
          <li>ğŸš¶</li>
          <li>ğŸƒ</li>
          <li>ğŸ’ƒ</li>

          <!-- Family -->
          <li>ğŸ‘«</li>
          <li>ğŸ’</li>
          <li>ğŸ’‘</li>
          <li>ğŸ¤°</li>
          <li>ğŸ‘ª</li>

          <!-- Hand, arm -->
          <li>ğŸ’ª</li>
          <li>ğŸ‘ˆ</li>
          <li>ğŸ‘‰</li>
          <li>â˜</li>
          <li>ğŸ‘†</li>
          <li>ğŸ‘‡</li>
          <li>ğŸ–</li>
          <li>âœŒ</li>
          <li>âœŠ</li>
          <li>âœ‹</li>
          <li>ğŸ‘Š</li>
          <li>ğŸ‘Œ</li>
          <li>ğŸ‘</li>
          <li>ğŸ‘</li>
          <li>ğŸ–•</li>
          <li>ğŸ‘‹</li>
          <li>ğŸ‘</li>
          <li>ğŸ‘</li>
          <li>ğŸ¤˜</li>
          <li>ğŸ¤™</li>
          <li>ğŸ¤š</li>
          <li>ğŸ¤›</li>
          <li>ğŸ¤œ</li>
          <li>ğŸ¤</li>
          <li>ğŸ¤</li>
          <li>ğŸ––</li>
          <li>âœ</li>
          <li>ğŸ’…</li>
          <li>ğŸ¤³</li>

          <!-- Face parts -->
          <li>ğŸ‘‚</li>
          <li>ğŸ‘ƒ</li>
          <li>ğŸ‘£</li>
          <li>ğŸ‘</li>
          <li>ğŸ‘€</li>
          <li>ğŸ‘…</li>
          <li>ğŸ‘„</li>
          <li>ğŸ’‹</li>

          <!-- Emotion -->
          <li>ğŸ’˜</li>
          <li>â¤</li>
          <li>ğŸ’“</li>
          <li>ğŸ’”</li>
          <li>ğŸ’•</li>
          <li>ğŸ’–</li>
          <li>ğŸ’—</li>
          <li>ğŸ’™</li>
          <li>ğŸ’š</li>
          <li>ğŸ’›</li>
          <li>ğŸ’œ</li>
          <li>ğŸ’</li>
          <li>ğŸ’</li>
          <li>ğŸ’Ÿ</li>
          <li>â£</li>
          <li>ğŸ’Œ</li>
          <li>ğŸ’¤</li>
          <li>ğŸ’¢</li>
          <li>ğŸ’£</li>
          <li>â˜ </li>
          <li>ğŸ’¥</li>
          <li>â˜¢</li>
          <li>â˜£</li>
          <li>ğŸ’¦</li>
          <li>ğŸ’§</li>
          <li>ğŸ’¨</li>
          <li>ğŸ’«</li>
          <li>ğŸ—£</li>
          <li>ğŸ—¨</li>
          <li>ğŸ’¬</li>
          <li>ğŸ—¯</li>
          <li>ğŸ‘â€ğŸ—¨</li>
          <li>ğŸ’­</li>
          <li>â€¼</li>
          <li>â‰</li>
          <li>â“</li>
          <li>â”</li>
          <li>â•</li>
          <li>â—</li>
          <li>â˜€</li>
          <li>â­</li>
          <li>ğŸŒŸ</li>
          <li>ğŸµ</li>
          <li>ğŸ¶</li>
          <li>âœ¨</li>
          <li>ğŸ”¥</li>
          <li>ğŸ‰</li>
          <li>ğŸŠ</li>
          <li>ğŸ</li>
          <li>ğŸ€</li>
          <li>ğŸ—</li>
          <li>ğŸµ</li>
        </ul>
        <h3>Fashion</h3>
        <ul>
          <li>ğŸ‘“</li>
          <li>ğŸ•¶</li>
          <li>ğŸ‘”</li>
          <li>ğŸ‘•</li>
          <li>ğŸ‘–</li>
          <li>ğŸ‘—</li>
          <li>ğŸ‘˜</li>
          <li>ğŸ‘™</li>
          <li>ğŸ‘š</li>
          <li>ğŸ‘›</li>
          <li>ğŸ‘œ</li>
          <li>ğŸ‘</li>
          <li>ğŸ’</li>
          <li>ğŸ›</li>
          <li>ğŸ‘</li>
          <li>ğŸ‘Ÿ</li>
          <li>ğŸ‘ </li>
          <li>ğŸ‘¡</li>
          <li>ğŸ‘¢</li>
          <li>ğŸ‘‘</li>
          <li>ğŸ‘’</li>
          <li>ğŸ©</li>
          <li>ğŸ“</li>
          <li>â›‘</li>
          <li>ğŸ’„</li>
          <li>ğŸ’</li>
          <li>ğŸ’</li>
        </ul>
        <h3>Animals</h3>
        <ul>
          <!-- Eto -->
          <li>ğŸ€</li>
          <li>ğŸ</li>
          <li>ğŸ‚</li>
          <li>ğŸƒ</li>
          <li>ğŸ„</li>
          <li>ğŸ…</li>
          <li>ğŸ†</li>
          <li>ğŸ‡</li>
          <li>ğŸˆ</li>
          <li>ğŸ‰</li>
          <li>ğŸŠ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ’</li>
          <li>ğŸ“</li>
          <li>ğŸ•</li>
          <li>ğŸ–</li>
 
          <!-- Eto Face -->
          <li>ğŸ­</li>
          <li>ğŸ¹</li>

          <li>ğŸ®</li>

          <li>ğŸ¯</li>

          <li>ğŸ°</li>

          <li>ğŸ²</li>

          <li>ğŸ´</li>
          <li>ğŸ¦„</li>

          <li>ğŸ‘</li>

          <li>ğŸµ</li>
          <li>ğŸ¦</li>

          <li>ğŸ¶</li>
          <li>ğŸ©</li>
          <li>ğŸº</li>

          <li>ğŸ·</li>
          <li>ğŸ—</li>
          <li>ğŸ½</li>

          <li>ğŸ±</li>
 
          <li>ğŸª</li>
          <li>ğŸ«</li>
          <li>ğŸ˜</li>
          <li>ğŸ»</li>
          <li>ğŸ¨</li>
          <li>ğŸ¼</li>
          <li>ğŸ¦</li>
          <li>ğŸ¦Š</li>
          <li>ğŸ¦Œ</li>
          <li>ğŸ¦</li>

          <li>ğŸ¾</li>

          <li>ğŸ”</li>
          <li>ğŸ£</li>
          <li>ğŸ¤</li>
          <li>ğŸ¥</li>
          <li>ğŸ¦</li>
          <li>ğŸ§</li>
          <li>ğŸ¦ƒ</li>
          <li>ğŸ¦…</li>
          <li>ğŸ¦†</li>
          <li>ğŸ¦‰</li>
          <li>ğŸ¦‡</li>

          <li>ğŸ¸</li>
          <li>ğŸ¢</li>
          <li>ğŸ¦</li>

          <li>ğŸ‹</li>
          <li>ğŸ³</li>
          <li>ğŸ¬</li>
          <li>ğŸ¦ˆ</li>
          <li>ğŸŸ</li>
          <li>ğŸ </li>
          <li>ğŸ¡</li>
          <li>ğŸ¦€</li>
          <li>ğŸ¦</li>
          <li>ğŸ™</li>
          <li>ğŸ¦‘</li>
          <li>ğŸš</li>

          <li>ğŸŒ</li>
          <li>ğŸ›</li>
          <li>ğŸœ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ¦‹</li>
          <li>ğŸ¦‚</li>
          <li>ğŸ•·</li>
          <li>ğŸ•¸</li>
        </ul>
        <h3>Plants, foods</h3>
        <ul>
          <!-- Flower -->
          <li>ğŸ’</li>
          <li>ğŸŒ¸</li>
          <li>ğŸ’®</li>
          <li>ğŸŒ¹</li>
          <li>ğŸŒº</li>
          <li>ğŸŒ»</li>
          <li>ğŸŒ¼</li>
          <li>ğŸ¥€</li>
          <li>ğŸŒ·</li>
          <li>ğŸŒ±</li>
          <li>âšœ</li>
 
          <!-- Tree -->
          <li>ğŸŒ²</li>
          <li>ğŸŒ³</li>
          <li>ğŸŒ´</li>
          <li>ğŸŒµ</li>
          <li>ğŸŒ¾</li>
          <!-- Leaf -->
          <li>ğŸŒ¿</li>
          <li>â˜˜</li>
          <li>ğŸ€</li>
          <li>ğŸ</li>
          <li>ğŸ‚</li>
          <li>ğŸƒ</li>

          <!-- Fluits -->
          <li>ğŸ‡</li>
          <li>ğŸˆ</li>
          <li>ğŸ‰</li>
          <li>ğŸŠ</li>
          <li>ğŸ‹</li>
          <li>ğŸŒ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ‘</li>
          <li>ğŸ’</li>
          <li>ğŸ“</li>
          <li>ğŸ…</li>
          <li>ğŸ†</li>
          <li>ğŸ¥</li>

          <!-- Vegetable -->
          <li>ğŸŒ½</li>
          <li>ğŸ„</li>
          <li>ğŸŒ°</li>
          <li>ğŸ¥‘</li>
          <li>ğŸ¥’</li>
          <li>ğŸ¥•</li>
          <li>ğŸ¥”</li>
          <li>ğŸ¥œ</li>
          <li>ğŸŒ¶</li>

          <!-- Bread -->
          <li>ğŸ</li>
          <li>ğŸ¥</li>

          <!-- Meat -->
          <li>ğŸ–</li>
          <li>ğŸ—</li>
          <li>ğŸ¥“</li>
          <li>ğŸ¥–</li>
          <!-- Fast foods -->
          <li>ğŸ”</li>
          <li>ğŸŸ</li>
          <li>ğŸ•</li>
          <li>ğŸ¥™</li>
          <li>ğŸŒ­</li>
          <li>ğŸŒ®</li>
          <li>ğŸŒ¯</li>
          <li>ğŸ¿</li>

          <!-- (Japanese) foods-->
          <li>ğŸ²</li>
          <li>ğŸ±</li>
          <li>ğŸ˜</li>
          <li>ğŸ™</li>
          <li>ğŸš</li>
          <li>ğŸ›</li>
          <li>ğŸœ</li>
          <li>ğŸ</li>
          <li>ğŸ </li>
          <li>ğŸ¢</li>
          <li>ğŸ£</li>
          <li>ğŸ¤</li>
          <li>ğŸ¥</li>
          <li>ğŸ¥—</li>
          <li>ğŸ¥˜</li>
          <li>ğŸ§€</li>
          <!-- Egg -->
          <li>ğŸ¥š</li>
          <li>ğŸ³</li>

          <!-- Sweets -->
          <li>ğŸ¡</li>
          <li>ğŸ¦</li>
          <li>ğŸ§</li>
          <li>ğŸ¨</li>
          <li>ğŸ©</li>
          <li>ğŸª</li>
          <li>ğŸ‚</li>
          <li>ğŸ°</li>
          <li>ğŸ¥</li>
          <li>ğŸ«</li>
          <li>ğŸ¬</li>
          <li>ğŸ­</li>
          <li>ğŸ®</li>
          <li>ğŸ¯</li>
 
          <!-- Drinks -->
          <li>â˜•</li>
          <li>ğŸµ</li>
          <li>ğŸ¶</li>
          <li>ğŸ·</li>
          <li>ğŸ¸</li>
          <li>ğŸ¹</li>
          <li>ğŸº</li>
          <li>ğŸ»</li>
          <li>ğŸ¥‚</li>
          <li>ğŸ¾</li>
          <li>ğŸ¥ƒ</li>
          <li>ğŸ¥›</li>
          <li>ğŸ¼</li>

          <!-- Silvers -->
          <li>ğŸ¥„</li>
          <li>ğŸ´</li>
          <li>ğŸ½</li>
          <li>ğŸ”ª</li>
        </ul>
        <h3>Seasons, events</h3>
        <ul>
          <!-- Seasons -->
          <li>ğŸƒ</li>
          <li>ğŸ„</li>
          <li>ğŸ†</li>
          <li>ğŸ‡</li>
          <li>ğŸ‹</li>
          <li>ğŸŒ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸ‘</li>

          <!-- Ball -->
          <li>âš½</li>
          <li>âš¾</li>
          <li>ğŸ€</li>
          <li>ğŸˆ</li>
          <li>ğŸ‰</li>
          <li>ğŸ¾</li>
          <li>ğŸ±</li>
          <li>ğŸ</li>
          <li>ğŸˆ</li>

          <!-- Sports -->
          <li>ğŸ³</li>
          <li>â›³</li>
          <li>ğŸŒ</li>
          <li>ğŸ</li>
          <li>ğŸ‘</li>
          <li>ğŸ’</li>
          <li>ğŸ“</li>
          <li>â›¸</li>
          <li>ğŸ£</li>
          <li>ğŸ½</li>
          <li>ğŸ¿</li>
          <li>â›·</li>
          <li>ğŸ‚</li>
          <li>ğŸ„</li>
          <li>ğŸŠ</li>
          <li>ğŸ¤½</li>
          <li>ğŸš´</li>
          <li>ğŸšµ</li>
          <li>ğŸ‡</li>
          <li>â›¹</li>
          <li>ğŸ¤¸</li>
          <li>ğŸ¤¹</li>
          <li>ğŸ¤º</li>
          <li>ğŸ¤»</li>
          <li>ğŸ¤¼</li>
          <li>ğŸ¤¾</li>
          <li>ğŸ‹</li>
          <li>ğŸ¥…</li>
          <li>ğŸ¥†</li>
          <li>ğŸ¸</li>
          <li>ğŸ¹</li>
          <li>ğŸ¥Š</li>
          <li>ğŸ¥‹</li>

          <!-- Prizes -->
          <li>ğŸ†</li>
          <li>ğŸ¥‡</li>
          <li>ğŸ¥ˆ</li>
          <li>ğŸ¥‰</li>
          <li>ğŸ–</li>

          <!-- Games -->
          <li>ğŸ¯</li>
          <li>ğŸ®</li>
          <li>ğŸ•¹</li>
          <li>ğŸ²</li>
          <li>â™ </li>
          <li>â™¥</li>
          <li>â™¦</li>
          <li>â™£</li>
          <li>ğŸƒ</li>
          <li>ğŸ€„</li>
          <li>ğŸ´</li>

          <!-- Sound, music -->
          <li>ğŸ”Š</li>
          <li>ğŸ“¢</li>
          <li>ğŸ“£</li>
          <li>ğŸ””</li>
          <li>ğŸ›</li>
          <li>ğŸ¼</li>
          <li>ğŸ¤</li>
          <li>ğŸ§</li>
          <li>ğŸ™</li>
          <li>ğŸ·</li>
          <li>ğŸ¸</li>
          <li>ğŸ¹</li>
          <li>ğŸº</li>
          <li>ğŸ»</li>
          <li>ğŸ“¯</li>
          <li>ğŸ¥</li>

          <!-- Science -->
          <li>ğŸ”¬</li>
          <li>ğŸ”­</li>
          <li>ğŸ”</li>
          <li>ğŸ”</li>
          <li>ğŸ“¡</li>
          <li>ğŸ”®</li>
          <li>âš–</li>
          <li>âš—</li>
          <li>âš›</li>
          <li>ğŸŒ¡</li>
 
          <!-- Electronics -->
          <li>ğŸ“»</li>
          <li>ğŸ“±</li>
          <li>ğŸ“²</li>
          <li>â˜</li>
          <li>ğŸ“</li>
          <li>ğŸ“Ÿ</li>
          <li>ğŸ“ </li>
          <li>ğŸ”‹</li>
          <li>ğŸ”Œ</li>
          <li>âŒ¨</li>
          <li>ğŸ–±</li>
          <li>ğŸ–²</li>
          <li>ğŸ–¥</li>
          <li>ğŸ–¨</li>
          <li>ğŸ’»</li>
          <li>ğŸ’½</li>
          <li>ğŸ’¾</li>
          <li>ğŸ’¿</li>
          <li>ğŸ“€</li>

          <!-- Movie, TV -->
          <li>ğŸ¥</li>
          <li>ğŸ«</li>
          <li>ğŸ¬</li>
          <li>ğŸ“º</li>
          <li>ğŸ“·</li>
          <li>ğŸ“¸</li>
          <li>ğŸ“¹</li>
          <li>ğŸ“¼</li>
          <li>ğŸ</li>
          <li>ğŸ“½</li>

          <!-- Lights -->
          <li>ğŸ•¯</li>
          <li>ğŸ•</li>
          <li>ğŸ’¡</li>
          <li>ğŸ”¦</li>
          <li>ğŸ®</li>

          <!-- Books -->
          <li>ğŸ“”</li>
          <li>ğŸ“•</li>
          <li>ğŸ“–</li>
          <li>ğŸ“—</li>
          <li>ğŸ“˜</li>
          <li>ğŸ“™</li>
          <li>ğŸ“š</li>
          <li>ğŸ““</li>
          <li>ğŸ“’</li>
          <li>ğŸ—’</li>
          <li>ğŸ“ƒ</li>
          <li>ğŸ“œ</li>
          <li>ğŸ“„</li>
          <li>ğŸ“°</li>
          <li>ğŸ“‘</li>
          <li>ğŸ”–</li>

          <!-- Money -->
          <li>ğŸ’°</li>
          <li>ğŸ’´</li>
          <li>ğŸ’µ</li>
          <li>ğŸ’¶</li>
          <li>ğŸ’·</li>
          <li>ğŸ’¸</li>
          <li>ğŸ’³</li>
          <li>ğŸŸ</li>
          <li>ğŸ’¹</li>

          <!-- Letters -->
          <li>âœ‰</li>
          <li>ğŸ“§</li>
          <li>ğŸ“¨</li>
          <li>ğŸ“©</li>
          <li>ğŸ“¤</li>
          <li>ğŸ“¥</li>
          <li>ğŸ“¦</li>
          <li>ğŸ“«</li>
          <li>ğŸ“ª</li>
          <li>ğŸ“¬</li>
          <li>ğŸ“­</li>
          <li>ğŸ“®</li>
          <li>âœ</li>
          <li>âœ’</li>
          <li>ğŸ–Š</li>
          <li>ğŸ–‹</li>
          <li>ğŸ–Œ</li>
          <li>ğŸ–</li>
          <li>ğŸ“</li>

          <li>ğŸ’¼</li>
          <li>ğŸ“</li>
          <li>ğŸ“‚</li>
          <!-- Office -->
          <li>ğŸ—‚</li>
          <li>ğŸ—ƒ</li>
          <li>ğŸ—„</li>
          <li>ğŸ—‘</li>
          <li>ğŸ—</li>

          <li>ğŸ“…</li>
          <li>ğŸ“†</li>
          <li>ğŸ—“</li>
          <li>ğŸ“‡</li>
          <li>ğŸ—³</li>

          <!-- Charts -->
          <li>ğŸ“ˆ</li>
          <li>ğŸ“‰</li>
          <li>ğŸ“Š</li>

          <!-- Clips -->
          <li>ğŸ“‹</li>
          <li>ğŸ“Œ</li>
          <li>ğŸ“</li>
          <li>ğŸ“</li>
          <li>ğŸ–‡</li>
          <li>ğŸ“</li>
          <li>ğŸ“</li>
          <li>âœ‚</li>
          <!-- Keys, locks-->
          <li>ğŸ”’</li>
          <li>ğŸ”“</li>
          <li>ğŸ”</li>
          <li>ğŸ”</li>
          <li>ğŸ”‘</li>
          <li>ğŸ—</li>

          <li>ğŸ”¨</li>
          <li>â›</li>
          <li>ğŸ”§</li>
          <li>ğŸ› </li>
          <li>âš’</li>
          <li>ğŸ”©</li>
          <li>ğŸ—œ</li>
          <li>ğŸ”—</li>
          <li>â›“</li>
          <li>ğŸ’‰</li>
          <li>ğŸ’Š</li>
          <li>ğŸ”«</li>
          <li>ğŸ—¡</li>
          <li>âš”</li>
          <li>ğŸ›¡</li>
          <li>âš°</li>
          <li>âš±</li>
          <li>ğŸº</li>
          <li>ğŸ–¼</li>
          <li>ğŸš¬</li>
          <li>ğŸ—¿</li>
        </ul>
        <h3>Places, travel, weather</h3>
        <ul>
          <li>ğŸŒ</li>
          <li>ğŸŒ</li>
          <li>ğŸŒ</li>
          <li>ğŸŒ</li>
          <li>ğŸ—º</li>
 
          <li>â›°</li>
          <li>ğŸ”</li>
          <li>ğŸŒ‹</li>
          <li>ğŸ—»</li>
          <li>ğŸ—</li>
          <li>ğŸ˜</li>
          <li>ğŸ </li>
          <li>ğŸ¡</li>
          <li>ğŸš</li>
          <li>â›ª</li>
          <li>â›©</li>
          <li>ğŸ›</li>
          <li>ğŸ•‹</li>
          <li>ğŸ•Œ</li>
          <li>ğŸ•</li>
          <li>ğŸ¢</li>
          <li>ğŸ£</li>
          <li>ğŸ¥</li>
          <li>ğŸ¦</li>
          <li>ğŸ¨</li>
          <li>ğŸ©</li>
          <li>ğŸª</li>
          <li>ğŸ«</li>
          <li>ğŸ¬</li>
          <li>ğŸ­</li>
          <li>ğŸ¯</li>
          <li>ğŸ°</li>
          <li>ğŸ’’</li>
 
          <li>ğŸ¤</li>
          <li>î”Š</li>
 
          <li>ğŸ—¼</li>
          <li>ğŸ—½</li>
          <li>ğŸ—¾</li>
          <li>â›²</li>
          <li>ğŸ•</li>
          <li>â›º</li>
          <li>ğŸŒ‡</li>
          <li>ğŸ™</li>
          <li>ğŸŒ</li>
          <li>ğŸŒ†</li>
          <li>ğŸŒƒ</li>
          <li>ğŸŒ„</li>
          <li>ğŸŒ…</li>
          <li>ğŸŒ‰</li>
          <li>â™¨</li>
          <li>ğŸ–</li>
          <li>ğŸœ</li>
          <li>ğŸ</li>
          <li>ğŸ</li>
          <li>ğŸŸ</li>
          <li>ğŸŒŒ</li>
          <li>ğŸ </li>
          <li>ğŸ¡</li>
          <li>ğŸ¢</li>
          <li>ğŸ’ˆ</li>
          <li>ğŸª</li>
          <li>ğŸ­</li>
          <li>ğŸ¨</li>
          <li>ğŸ°</li>

          <li>ğŸšƒ</li>
          <li>ğŸš„</li>
          <li>ğŸš…</li>
          <li>ğŸš‚</li>
          <li>ğŸš†</li>
          <li>ğŸšˆ</li>
          <li>ğŸšŠ</li>
          <li>ğŸš‹</li>
          <li>ğŸš</li>
          <li>ğŸš</li>
          <li>ğŸšŸ</li>
          <li>ğŸš </li>
          <li>ğŸš¡</li>
          <li>ğŸš‡</li>
          <li>ğŸš‰</li>
          <li>ğŸ›¤</li>

          <li>ğŸšŒ</li>
          <li>ğŸš</li>
          <li>ğŸš‘</li>
          <li>ğŸš’</li>
          <li>ğŸš“</li>
          <li>ğŸš•</li>
          <li>ğŸš—</li>
          <li>ğŸš™</li>
          <li>ğŸšš</li>
          <li>ğŸš</li>
          <li>ğŸš</li>
          <li>ğŸš</li>
          <li>ğŸš”</li>
          <li>ğŸš–</li>
          <li>ğŸš˜</li>
          <li>ğŸš›</li>
          <li>ğŸšœ</li>
          <li>ğŸ</li>
          <li>ğŸ›£</li>
 
          <li>ğŸš²</li>
          <li>ğŸ</li>
          <li>â›½</li>
          <li>ğŸ›¢</li>
          <li>ğŸš¨</li>
          <li>ğŸš¥</li>
          <li>ğŸš§</li>

          <li>âš“</li>
          <li>â›µ</li>
          <li>ğŸš£</li>
          <li>ğŸš¤</li>
          <li>ğŸ›¥</li>
          <li>â›´</li>
          <li>ğŸ›³</li>
          <li>ğŸš¢</li>

          <li>ğŸ›©</li>
          <li>âœˆ</li>
          <li>ğŸ›«</li>
          <li>ğŸ›¬</li>
          <li>ğŸš</li>
          <li>ğŸ’º</li>
          <li>ğŸš€</li>
          <li>ğŸ›°</li>

          <li>ğŸšª</li>
          <li>ğŸš½</li>
          <li>ğŸš¿</li>
          <li>ğŸ›</li>
          <li>ğŸ›€</li>
          <li>ğŸ›‹</li>
          <li>ğŸ›</li>
          <li>ğŸ›Œ</li>

          <li>âŒ›</li>
          <li>â³</li>
          <li>âŒš</li>
          <li>â°</li>
          <li>â±</li>
          <li>â²</li>
          <li>ğŸ•°</li>
          <li>ğŸ•›</li>
          <li>ğŸ•</li>
          <li>ğŸ•‘</li>
          <li>ğŸ•’</li>
          <li>ğŸ•“</li>
          <li>ğŸ•”</li>
          <li>ğŸ••</li>
          <li>ğŸ•–</li>
          <li>ğŸ•—</li>
          <li>ğŸ•˜</li>
          <li>ğŸ•™</li>
          <li>ğŸ•š</li>

          <li>ğŸŒ–</li>
          <li>ğŸŒ—</li>
          <li>ğŸŒ˜</li>
          <li>ğŸŒ‘</li>
          <li>ğŸŒ’</li>
          <li>ğŸŒ“</li>
          <li>ğŸŒ”</li>
          <li>ğŸŒ•</li>
          <li>ğŸŒ™</li>
          <li>ğŸŒ›</li>
          <li>ğŸŒœ</li>
          <li>ğŸŒ</li>
          <li>ğŸŒš</li>

          <li>ğŸŒ</li>
          <li>ğŸŒ </li>
          <li>â˜</li>
          <li>ğŸŒ¤</li>
          <li>â›…</li>
          <li>ğŸŒ¥</li>
          <li>ğŸŒ¦</li>
          <li>ğŸŒ§</li>
          <li>ğŸŒ‚</li>
          <li>â˜‚</li>
          <li>â˜”</li>
          <li>â›±</li>
          <li>ğŸŒˆ</li>
          <li>ğŸŒ€</li>
          <li>ğŸŒª</li>
          <li>ğŸŒ¬</li>
          <li>âš¡</li>
          <li>ğŸŒ©</li>
          <li>â›ˆ</li>
          <li>ğŸŒ¨</li>
          <li>â„</li>
          <li>â˜ƒ</li>
          <li>â›„</li>
          <li>ğŸŒ«</li>
          <li>ğŸŒŠ</li>
          <li>â˜„</li>
        </ul>
        <h3>Generic symbols</h3>
        <ul>
          <li>ğŸ³</li>
          <li>ğŸ´</li>
          <li>ğŸ</li>
          <li>ğŸš©</li>
          <li>ğŸ§</li>
          <li>â™¿</li>
          <li>ğŸš¹</li>
          <li>ğŸšº</li>
          <li>ğŸš»</li>
          <li>ğŸš¼</li>
          <li>ğŸš¾</li>
 
          <li>ğŸš®</li>
          <li>ğŸš¯</li>
          <li>ğŸš°</li>
          <li>ğŸš±</li>
          <li>ğŸš³</li>
          <li>ğŸ›‚</li>
          <li>ğŸ›ƒ</li>
          <li>ğŸ›„</li>
          <li>ğŸ›…</li>
          <li>#âƒ£</li>
          <li>*âƒ£</li>
          <li>â˜‘</li>
          <li>ğŸš·</li>
          <li>ğŸš¸</li>
          <li>ğŸ•³</li>
 
          <li>âš </li>
          <li>â›”</li>
          <li>ğŸš«</li>
 
          <li>ğŸš¦</li>
 
          <li>ğŸš­</li>
          <li>â¬†</li>
          <li>â†—</li>
          <li>â¡</li>
          <li>â†˜</li>
          <li>â¬‡</li>
          <li>â†™</li>
          <li>â¬…</li>
          <li>â†–</li>
          <li>â†•</li>
          <li>â†”</li>
          <li>â†©</li>
          <li>â†ª</li>
          <li>â¤´</li>
          <li>â¤µ</li>
          <li>ğŸ”ƒ</li>
          <li>ğŸ”™</li>
          <li>ğŸ”š</li>
          <li>ğŸ”›</li>
          <li>ğŸ”œ</li>
          <li>ğŸ”</li>
          <li>âœ¡</li>
          <li>âœ</li>
          <li>ğŸ”¯</li>
          <li>ğŸ“¿</li>
          <li>ğŸ•‰</li>
          <li>ğŸ•Š</li>
          <li>ğŸ›</li>
          <li>â˜¦</li>
          <li>â˜ª</li>
          <li>â˜®</li>
          <li>â˜¯</li>
          <li>â˜¸</li>
          <li>â™»</li>
          <li>ğŸ“›</li>
          <li>ğŸ·</li>
          <li>ğŸ”°</li>
          <li>ğŸ”±</li>
          <li>â­•</li>
          <li>âœ…</li>
          <li>âœ”</li>
          <li>âœ–</li>
          <li>âŒ</li>
          <li>â</li>
          <li>â•</li>
          <li>â–</li>
          <li>â—</li>
          <li>â°</li>
          <li>â¿</li>
          <li>ã€½</li>
          <li>âœ³</li>
          <li>âœ´</li>
          <li>â‡</li>
          <li>ğŸ’±</li>
          <li>ğŸ’²</li>
          <li>ã€°</li>
          <li>Â©</li>
          <li>Â®</li>
          <li>â„¢</li>
          <li>â™ˆ</li>
          <li>â™‰</li>
          <li>â™Š</li>
          <li>â™‹</li>
          <li>â™Œ</li>
          <li>â™</li>
          <li>â™</li>
          <li>â™</li>
          <li>â™</li>
          <li>â™‘</li>
          <li>â™’</li>
          <li>â™“</li>
          <li>â›</li>
          <li>â–¶</li>
          <li>â©</li>
          <li>â­</li>
          <li>â—€</li>
          <li>âª</li>
          <li>â®</li>
          <li>ğŸ”¼</li>
          <li>â«</li>
          <li>ğŸ”½</li>
          <li>â¬</li>
          <li>â</li>
          <li>â¸</li>
          <li>â¯</li>
          <li>â¹</li>
          <li>âº</li>
 
          <li>ğŸ”€</li>
          <li>ğŸ”</li>
          <li>ğŸ”‚</li>
          <li>ğŸ”„</li>
          <li>ğŸ“µ</li>
          <li>ğŸ”…</li>
          <li>ğŸ”†</li>
          <li>ğŸ”‡</li>
          <li>ğŸ”ˆ</li>
          <li>ğŸ”‰</li>
          <li>ğŸ”•</li>
          <li>âš™</li>
          <li>ğŸš</li>
          <li>ğŸ›</li>
 
          <li>ğŸ¦</li>
          <li>ğŸ“¶</li>
          <li>ğŸ“³</li>
          <li>ğŸ“´</li>
          <li>ğŸ”Ÿ</li>
          <li>ğŸ’¯</li>
          <li>ğŸ”</li>
 
          <li></li>
          <li></li>
          <li></li>
          <li></li>
 
          <li>ğŸ” </li>
          <li>ğŸ”¡</li>
          <li>ğŸ”¢</li>
          <li>ğŸ”£</li>
          <li>ğŸ”¤</li>
          <li>ğŸ…°</li>
          <li>ğŸ†</li>
          <li>ğŸ…±</li>
          <li>ğŸ†‘</li>
          <li>ğŸ†’</li>
          <li>ğŸ†“</li>
          <li>â„¹</li>
          <li>ğŸ†”</li>
          <li>â“‚</li>
          <li>ğŸ†•</li>
          <li>ğŸ†–</li>
          <li>ğŸ…¾</li>
          <li>ğŸ†—</li>
          <li>ğŸ…¿</li>
          <li>ğŸ†˜</li>
          <li>ğŸ†™</li>
          <li>ğŸ†š</li>
          <li>ğŸˆ</li>
          <li>ğŸˆ‚</li>
          <li>ğŸˆ·</li>
          <li>ğŸˆ¶</li>
          <li>ğŸˆ¯</li>
          <li>ğŸ‰</li>
          <li>ğŸˆ¹</li>
          <li>ğŸˆš</li>
          <li>ğŸˆ²</li>
          <li>ğŸ‰‘</li>
          <li>ğŸˆ¸</li>
          <li>ğŸˆ´</li>
          <li>ğŸˆ³</li>
          <li>ãŠ—</li>
          <li>ãŠ™</li>
          <li>ğŸˆº</li>
          <li>ğŸˆµ</li>
          <li>â–ª</li>
          <li>â–«</li>
          <li>â—»</li>
          <li>â—¼</li>
          <li>â—½</li>
          <li>â—¾</li>
          <li>â¬›</li>
          <li>â¬œ</li>
          <li>ğŸ”¶</li>
          <li>ğŸ”·</li>
          <li>ğŸ”¸</li>
          <li>ğŸ”¹</li>
          <li>ğŸ”º</li>
          <li>ğŸ”»</li>
          <li>ğŸ’ </li>
          <li>ğŸ”˜</li>
          <li>ğŸ”²</li>
          <li>ğŸ”³</li>
          <li>âšª</li>
          <li>âš«</li>
          <li>ğŸ”´</li>
          <li>ğŸ”µ</li>
 
          <li>ğŸ‡¦</li>
          <li>ğŸ‡§</li>
          <li>ğŸ‡¨</li>
          <li>ğŸ‡©</li>
          <li>ğŸ‡ª</li>
          <li>ğŸ‡«</li>
          <li>ğŸ‡¬</li>
          <li>ğŸ‡­</li>
          <li>ğŸ‡®</li>
          <li>ğŸ‡¯</li>
          <li>ğŸ‡°</li>
          <li>ğŸ‡±</li>
          <li>ğŸ‡²</li>
          <li>ğŸ‡³</li>
          <li>ğŸ‡´</li>
          <li>ğŸ‡µ</li>
          <li>ğŸ‡¶</li>
          <li>ğŸ‡·</li>
          <li>ğŸ‡¸</li>
          <li>ğŸ‡¹</li>
          <li>ğŸ‡º</li>
          <li>ğŸ‡»</li>
          <li>ğŸ‡¼</li>
          <li>ğŸ‡½</li>
          <li>ğŸ‡¾</li>
          <li>ğŸ‡¿</li>
 
          <li>0âƒ£</li>
          <li>1âƒ£</li>
          <li>2âƒ£</li>
          <li>3âƒ£</li>
          <li>4âƒ£</li>
          <li>5âƒ£</li>
          <li>6âƒ£</li>
          <li>7âƒ£</li>
          <li>8âƒ£</li>
          <li>9âƒ£</li>
        </ul>
      </section>
    </section>

    <script>
    var gEditor;
    var gRecent;
    var gAll;
    var gRecentList;
    var gRecentEmoji;
    var gCursorPosition = -1;

    var gEditingObserver;
    var gEditing = false;
    var gEditingThrottleTimer = null;

    function init() {
      initPalette();

      gEditor = document.getElementById('editor');
      gRecent = document.getElementById('recent');
      gAll = document.getElementById('all');

      gRecentList = document.querySelector('#recent ul');
      gRecentEmoji = (localStorage.getItem('recent') || '')
          .split('\n')
          .filter(function(aEmoji) {
            return aEmoji.trim() !== '';
          });

      var lastHeight = localStorage.getItem('editorHeight');
      if (lastHeight)
        gEditor.style.height = lastHeight;

      startObserveEditor();
      updateRecentList();
      // updateLayout();

      gEditor.focus();

      var lastContent = localStorage.getItem('lastContent');
      if (lastContent)
        gEditor.innerHTML = lastContent.replace(/<\/div[^>]*>/g, '');

      gEditor.addEventListener('keypress', function(aEvent){
        if (aEvent.keyCode == aEvent.DOM_VK_TAB &&
            !aEvent.altKey &&
            !aEvent.ctrlKey &&
            !aEvent.metaKey &&
            !aEvent.shiftKey &&
            document.execCommand('insertText', false, '\t'))
          aEvent.preventDefault();
      });

      gEditor.addEventListener('copy', function(aEvent){
        var text = rangeToPlainText(window.getSelection().getRangeAt(0));
        aEvent.clipboardData.setData('text/plain', text);
        aEvent.preventDefault();
      });
      gEditor.addEventListener('cut', function(aEvent){
        var text = rangeToPlainText(window.getSelection().getRangeAt(0));
        aEvent.clipboardData.setData('text/plain', text);
        if (document.execCommand('delete'))
          aEvent.preventDefault();
      });
      gEditor.addEventListener('paste', function(aEvent){
        var text = aEvent.clipboardData.getData('text/plain') || '';
        var command = 'insertText';
        if ('twemoji' in window) {
          text = twemoji.parse(sanitizeForHTML(text));
          command = 'insertHTML';
        }
        gEditor.focus();
        if (document.execCommand(command, false, text))
          aEvent.preventDefault();
      });

      gEditor.addEventListener('compositionstart', function(aEvent){
        gEditing = true;
      });
      gEditor.addEventListener('compositionend', function(aEvent){
        gEditing = false;
        onEdit();
      });
    }

    function sanitizeForHTML(aInput) {
      return aInput.replace(/&/g, '&amp;')
                   .replace(/>/g, '&lt;')
                   .replace(/</g, '&lt;');
    }

    // window.getSelection().toString() extracts tab character(\u0009)s
    // as space(\u0020)s if there is any image element, so we need to
    // construct really selected text with tab characters.
    function rangeToPlainText(aRange) {
      // line delimiter is automatically detected by the browser
      // for each platform.
      var prettyText = window.getSelection().toString();
      var linesDelimiter = /(\r?\n)/.test(prettyText) ? RegExp.$1 : '\n';

      var text = '';
      var target = aRange.startContainer;
      if (target.nodeType == target.ELEMENT_NODE &&
          !/^(img|br)$/i.test(target.localName))
        target = target.childNodes[aRange.startOffset];

      var targets = editableNodes();
      var initialTarget = target;
      for (target of targets)
      {
        if (initialTarget) {
          if (target != initialTarget)
            continue;
          initialTarget = null;
        }

        if (target.nodeType == target.TEXT_NODE) {
          let value = target.nodeValue;
          if (target == aRange.endContainer)
            value = value.slice(0, aRange.endOffset);
          if (target == aRange.startContainer)
            value = value.slice(aRange.startOffset);
          text += value;
        }
        else if (target.localName.toUpperCase() == 'BR') {
          text += linesDelimiter;
        }
        else if (target.alt) {
          text += target.alt;
        }

        if (target.nodeType == target.TEXT_NODE ?
              target == aRange.endContainer :
              target == aRange.endContainer.childNodes[aRange.endOffset - 1])
          break;
      }
      return text;
    }

    function editableNodes() {
      var nodes = document.evaluate(
        'descendant::text() | descendant::*[contains("img,IMG,br,BR", local-name())]',
        gEditor,
        null,
        XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
        null
      );
      return (function* () {
        for (var i = 0, maxi = nodes.snapshotLength; i < maxi; i++)
        {
          yield nodes.snapshotItem(i);
        }
      })();
    }

    function destroy() {
      if (gEditingObserver)
        gEditingObserver.disconnect();
    }

    function emojify(aTarget) {
      if (!('twemoji' in window))
        return false;

      var beforeCount = aTarget.querySelectorAll('img.emoji').length;
      gCursorPosition = getCursorPosition();
      twemoji.parse(aTarget, { size: 72 });
      setTimeout(function() {
        var afterCount = aTarget.querySelectorAll('img.emoji').length;
        if (aTarget == gEditor &&
            gCursorPosition > -1 &&
            beforeCount != afterCount &&
            gCursorPosition != getCursorPosition())
          setCursorAt(gCursorPosition);
      }, 0);
      return true;
    }

    function getCursorPosition() {
      try {
        var cursor = window.getSelection().getRangeAt(0).cloneRange();
        cursor.collapse(false);
        var firstEditable = editableNodes().next().value;
        cursor.setStart(firstEditable, 0);
        return unicodeStringToChars(rangeToPlainText(cursor)).length;
      }
      catch(e) {
        return -1;
      }
    }

    // See: http://qiita.com/YusukeHirao/items/2f0fb8d5bbb981101be0
    function unicodeStringToChars(aInput) {
      return aInput.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g) || [];
    }

    function setCursorAt(aPosition) {
      try {
        var targets = editableNodes();
        var target = targets.next().value;

        var selection = window.getSelection();
        var cursor = document.createRange();
        cursor.setStart(target, 0);
        var restCount = aPosition;
        while (target && restCount > 0)
        {
          if (target.nodeType == target.TEXT_NODE) {
            let value = target.nodeValue;
            if (value.length >= restCount) {
              cursor.setEnd(target, restCount);
              break;
            }
            restCount -= unicodeStringToChars(value).length;
          }
          else {
            restCount--;
          }
          cursor.setEndAfter(target);

          target = targets.next().value;
        }
        cursor.collapse(false);
        selection.removeAllRanges();
        selection.addRange(cursor);
      }
      catch(e) {
        console.log('failed to move cursor: ', e);
      }
    }

    function startObserveEditor() {
      gEditingObserver = new MutationObserver(function(aMutations) {
        if (gEditing)
          return;
        aMutations.forEach(function(aMutation) {
          if (aMutation.type == 'attributes') {
            if (aMutation.attributeName == 'style')
              updateLayout();
          }
          else {
            onEdit();
          }
        });
      });
      gEditingObserver.observe(gEditor, {
        attributes    : true,
        childList     : true,
        characterData : true,
        subtree       : true
      });
    }

    function onEdit() {
      if (gEditingThrottleTimer)
        clearTimeout(gEditingThrottleTimer);
      gEditingThrottleTimer = setTimeout(function() {
        gEditingThrottleTimer = null;
        gEditing = true;

        localStorage.setItem('lastContent', gEditor.innerHTML);

        if (gEditor.textContent.trim() == '' &&
            !gEditor.querySelector('img'))
          gEditor.setAttribute('data-blank', 'true');
        else
          gEditor.removeAttribute('data-blank');

        emojify(gEditor);

        setTimeout(function() {
          gEditing = false;
        }, 10);
      }, 250);
    }

    function updateLayout() {
      var topMargin = gEditor.clientHeight + 10 /* margin */;
      gRecent.style.top = topMargin + 'px';
      var recentItemsHeight = gRecent.querySelector('ul').clientHeight;
      gRecent.style.height = recentItemsHeight + 'px';

      gAll.style.top = (topMargin + gRecent.clientHeight) + 'px';

      var height = window.getComputedStyle(gEditor, null).getPropertyValue('height');
      localStorage.setItem('editorHeight', height);
    }

    function insertEmoji(aEvent) {
      var target = aEvent.target;
      while (target.nodeType != target.ELEMENT_NODE)
        target = target.parentNode;

      if (String(target.localName).toUpperCase() != 'IMG' &&
          target.className != 'emoji')
        return;

      var emoji = target.alt || target.getAttribute('data-emoji');

      var text = emoji;
      var command = 'insertText';
      if ('twemoji' in window) {
        text = twemoji.parse(text);
        command = 'insertHTML';
      }
      gEditor.focus();
      setTimeout(function() { // do after focused
        document.execCommand(command, false, text);
        addRecentEmoji(emoji);
      }, 0);
    }

    function addRecentEmoji(aEmoji) {
      var index = gRecentEmoji.indexOf(aEmoji);
      if (index > -1)
        gRecentEmoji.splice(index, 1);
      gRecentEmoji.unshift(aEmoji);
      gRecentEmoji = gRecentEmoji.slice(0, 25);
      updateRecentList();
      localStorage.setItem('recent', gRecentEmoji.join('\n'));
    }

    function updateRecentList() {
      var range = document.createRange();
      range.selectNodeContents(gRecentList);
      range.deleteContents();
      range.detach();

      gRecentEmoji.forEach(function(aEmoji) {
        var item = document.createElement('li');
        item.className = 'emoji';
        if ('twemoji' in window) {
          item.innerHTML = twemoji.parse(aEmoji);
        }
        else {
          item.appendChild(document.createTextNode(aEmoji));
        }
        gRecentList.appendChild(item);
      });

      updateLayout();
    }

    function initPalette() {
      var palette = document.getElementById('emoji-palette');
      var emojified = emojify(palette);
      for (let item of palette.querySelectorAll('li'))
      {
        item.className = 'emoji';
        if (!emojified || !item.firstChild)
          continue;
        if (item.firstChild.nodeType == Node.TEXT_NODE) {
          item.style.display = 'none';
        }
        else {
          item.setAttribute('data-emoji', item.firstChild.alt);
        }
      }

      var maybeWhitespaces = document.evaluate(
        'descendant::text()',
        palette,
        null,
        XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
        null
      );
      for (let i = 0, maxi = maybeWhitespaces.snapshotLength;
           i < maxi;
           i++)
      {
        let space = maybeWhitespaces.snapshotItem(i);
        if (space.nodeValue.trim() == '')
          space.parentNode.removeChild(space);
      }
    }

    if (location.protocol != 'file:') {
      let script = document.createElement('script');
      script.setAttribute('src', '//twemoji.maxcdn.com/2/twemoji.min.js?2.2.2');
      document.body.appendChild(script);
    }
    </script>
  </body>
</html>
